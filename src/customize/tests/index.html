<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/@shopify/polaris@5/dist/styles.css" />
    <style>
        body {
            margin: 50px;
            background: paleturquoise;
        }

        body>div {
            width: 250px;
        }
    </style>
</head>

<body>



    <div class="_2_Ab2">
        <div kc-panel-setting="register|--input-line|">
            <div style="display: flex; align-items: center; align-content: center; margin-bottom: 5px;"><img
                    src="https://unpkg.com/@shopify/polaris-icons@4.0.0/dist/svg/EditMinor.svg"
                    style="width: 15px; height: 15px; opacity: 0.7;">
                <h4 style="margin-left: 8px;">Input Line</h4>
            </div>

            <div style="display: flex;"><input class="" type="number" min="-999" max="999" value="1"
                    style="border: 0px; height: 40px; width: 15%;"><select class=""
                    style="border: 0px; height: 40px; width: 30%;">
                    <option value="px">px</option>
                    <option value="%">%</option>
                </select><select class="" style="border: 0px; height: 40px; width: 40%;">
                    <option value="solid">solid</option>
                    <option value="dashed">dashed</option>
                    <option value="dotted">dotted</option>
                </select>
                <div style="position: relative; width: 15%;">
                    <div
                        style="width: 100%; height: 100%; cursor: pointer; border-radius: 5px; padding: 15px; background: black;">
                    </div>
                </div>
            </div>
            <p class="kc-setting-hint">You can set the input line</p>
        </div>
    </div>
    <div class="_2_Ab2">
        <div kc-panel-setting="register|--input-line-direction|">
            <div style="display: flex; align-items: center; align-content: center; margin-bottom: 5px;">
                <h4 style="margin-left: 0px;">input-line-direction</h4>
            </div>
            <div style="display: flex; align-items: center;">
                <div style="position: relative; width: 100%;"><input class="next-input" type="text"
                        name="input-line-direction" placeholder="" value="Bottom,Left"></div>
            </div>
        </div>
    </div>
    <script>

        const InputLineComponent = () => {
            const _getCheckbox = (name) => `<span>
            <label class="Polaris-Choice" for="${name}">
                <span class="Polaris-Choice__Control">
                    <span class="Polaris-Checkbox"><input id="${name}" name="${name}" type="checkbox" class="Polaris-Checkbox__Input"
                            aria-invalid="false" role="checkbox" aria-checked="false" value="">
                        <span class="Polaris-Checkbox__Backdrop"></span>
                        <span class="Polaris-Checkbox__Icon"><span class="Polaris-Icon"><svg viewBox="0 0 20 20"
                                    class="Polaris-Icon__Svg" focusable="false" aria-hidden="true">
                                    <path
                                        d="m8.315 13.859-3.182-3.417a.506.506 0 0 1 0-.684l.643-.683a.437.437 0 0 1 .642 0l2.22 2.393 4.942-5.327a.436.436 0 0 1 .643 0l.643.684a.504.504 0 0 1 0 .683l-5.91 6.35a.437.437 0 0 1-.642 0">
                                    </path>
                                </svg></span></span>
                    </span>
                </span>
                <span class="Polaris-Choice__Label">${name}</span></label>
            </span>`;


            const _getRadio = (name) => `<div class="Polaris-Stack__Item">
                <label class="Polaris-Choice" for="${name}"><span class="Polaris-Choice__Control"><span
                            class="Polaris-RadioButton"><input id="${name}" name="accounts" type="radio"
                                class="Polaris-RadioButton__Input" aria-describedby="disabledHelpText" value="${name}"
                                checked=""><span class="Polaris-RadioButton__Backdrop"></span></span></span><span
                        class="Polaris-Choice__Label">${name}</span></label>
            </div>`;


            const _onCheckboxClick = (event) => {
                const { target } = event;
                window.target = target;
                const checkedElems = target.closest(".checkboxes").querySelectorAll("[type='checkbox']");
                const checkedList = Array.from(checkedElems).filter(e => e.checked);
                const values = checkedList.map(e => e.name).join(",");
                _resetRadio(event);
                _setDirectionValue(target, values);
            };

            const _onRadioClick = (event) => {
                const { target } = event;
                const inputs = target.closest(".checkboxes").querySelectorAll("[type='checkbox']");
                inputs.forEach(e => e.checked = target.value === "All");
                _setDirectionValue(target, target.value);
            }

            const _addEventListiner = (current) => {
                const checkboxes = current.querySelectorAll(".checkboxes input[type='checkbox']");
                const radios = current.querySelectorAll(".checkboxes input[type='radio']");
                checkboxes.forEach(e => e.addEventListener("click", _onCheckboxClick));
                radios.forEach(e => e.addEventListener("click", _onRadioClick));
            }


            const _setDirectionValue = (target, value) => {
                const el = target.closest("[kc-panel-setting]").parentElement.nextElementSibling
                    .querySelector("input")
                setReactInputValue(el, value);
            }

            const _resetRadio = ({ target }) => {
                const els = target.closest(".checkboxes").querySelectorAll("[type='radio']");
                els.forEach(e => e.checked = false);
            }

            const _updateDirection = (current) => {
                window.current = current;
                const { value } = current.parentElement.nextElementSibling.querySelector("input");
                const checkboxes = current.querySelectorAll("input[type='checkbox']");
                checkboxes.forEach(e => e.checked = new RegExp(e.name, "i").test(value));
                current.closest("[kc-panel-setting]").parentElement.nextElementSibling.style.display = "none";
            }

            const init = (current) => {
                const htmlObjName = "checkboxes";
                const childName = current?.querySelector(`.${htmlObjName}`);
                console.log(current)
                if (!current || childName) return null;


                const checkboxList = ["Top", "Right", "Left", "Bottom"].map(e => _getCheckbox(e));
                const radioList = ["All", "None"].map(e => _getRadio(e));
                const htmlObj = document.createElement('div');
                htmlObj.className = htmlObjName;
                htmlObj.innerHTML = `<div>${checkboxList}</div><div class="Polaris-Stack">${radioList}</div>`.replace(/,/g, "");
                current.querySelector("div").insertAdjacentElement("afterend", htmlObj);
                _addEventListiner(current);
                _updateDirection(current);
            }

            return { init };
        }

        const setReactInputValue = (input, value) => {
            const previousValue = input.value;
            input.value = value;
            const tracker = input._valueTracker;
            if (tracker) tracker.setValue(previousValue);
            // 'change' instead of 'input', see https://github.com/facebook/react/issues/11488#issuecomment-381590324
            input.dispatchEvent(new Event('change', { bubbles: true }));
        }

        const addInputLineCheckbox = (_, { current }) => {
            InputLineComponent().init(current);
        };
        window.current = document.querySelector('[kc-panel-setting="register|--input-line|"]')
        addInputLineCheckbox("", { current });

    </script>
</body>

</html>